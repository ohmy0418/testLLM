<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sigma.js Large Graph Example</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/2.4.0/sigma.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/graphology/0.25.4/graphology.umd.min.js"></script>
  <style>
      #container {
          width: 100%;
          height: 800px;
      }

      #search {
          margin-bottom: 10px;
      }

      #tooltip {
          position: absolute;
          display: none;
          background: white;
          border: 1px solid black;
          padding: 5px;
          pointer-events: none;
      }
  </style>
</head>
<body>
<input type="text" id="search" placeholder="Search node...">
<button onclick="searchNode()">검색하기</button>
<button onclick="resetGraph()">초기화</button>
<div id="container"></div>
<div id="tooltip"></div>

<script>
  const graph = new graphology.Graph();
  const container = document.getElementById('container');
  const tooltip = document.getElementById('tooltip');

  // Generate nodes and edges
  for (let i = 0; i < 1000; i++) {
    graph.addNode(i.toString(), {
      label: 'Node ' + i,
      x: Math.random() * 1000 - 500,
      y: Math.random() * 1000 - 500,
      size: 10,
      color: '#' + Math.floor(Math.random() * 16777215).toString(16)
    });

    if (i > 0) {
      graph.addEdge((i - 1).toString(), i.toString());
    }
  }

  const renderer = new Sigma(graph, container);

  // Enable zoom and pan
  renderer.getMouseCaptor()

  function searchNode() {
    // Search feature
    let searchTerm = document.getElementById('search').value;

    graph.nodes().forEach(node => {
      const data = graph.getNodeAttributes(node);
      if (data.label.indexOf(searchTerm) === -1) {
        data.color = "#ccc";
      } else {
        data.color = "#E96842";
        data.size = 14;
      }
    });
    renderer.refresh();
  }

  function resetGraph() {
    graph.nodes().forEach(node => {
          const data = graph.getNodeAttributes(node);
          data.color = '#' + Math.floor(Math.random() * 16777215).toString(16);
          data.size = 10;
        }
    );
    renderer.refresh(); // 그래프 새로고침
  }

  // Mouse over interaction
  renderer.on('enterNode', (event) => {
    const node = event.node;
    const attributes = graph.getNodeAttributes(node);
    node.size = node.size * 1.5;
    tooltip.style.display = 'block';
    tooltip.style.left = event.event.clientX + 10 + 'px';
    tooltip.style.top = event.event.clientY + 10 + 'px';
    tooltip.innerHTML = `Node: ${attributes.label}`;
  });

  renderer.on('leaveNode', (event) => {
    const node = event.node;
    node.size = node.size * 1.5;
    tooltip.style.display = 'none';
  });
</script>
</body>
</html>
